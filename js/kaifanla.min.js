var app=angular.module("kaifanla",["ionic"]);app.config(function(c,b,a){a.tabs.position("bottom");c.state("start",{templateUrl:"tpl/start.html",url:"/kflStart"}).state("main",{templateUrl:"tpl/main.html",url:"/kflMain",controller:"mainCtrl"}).state("detail",{templateUrl:"tpl/detail.html",url:"/kflDetail/:id",controller:"detailCtrl"}).state("order",{templateUrl:"tpl/order.html",url:"/kflOrder/:id",controller:"orderCtrl"}).state("myOrder",{templateUrl:"tpl/myOrder.html",url:"/kflMyOrder",controller:"myOrderCtrl"});b.otherwise("/kflStart")});app.controller("parentCtrl",["$scope","$state",function(a,b){a.jump=function(c,d){console.log(" jump func is called ");b.go(c,d)}}]);app.controller("mainCtrl",["$scope","$http",function(a,b){a.hasMore=true;a.dishList=[];b.get("data/dish_getbypage.php?start=0").success(function(c){console.log(c);a.dishList=c});a.loadMore=function(){b.get("data/dish_getbypage.php?start="+a.dishList.length).success(function(c){if(c.length<5){a.hasMore=false}a.dishList=a.dishList.concat(c);a.$broadcast("scroll.infiniteScrollComplete")})};a.inputTxt={kw:""};a.$watch("inputTxt.kw",function(){if(a.inputTxt.kw.length>0){b.get("data/dish_getbykw.php?kw="+a.inputTxt.kw).success(function(c){if(c.length>0){a.dishList=c}})}})}]);app.controller("detailCtrl",["$scope","$stateParams","$http",function(a,b,d){console.log(b);var c=b.id;d.get("data/dish_getbyid.php?id="+c).success(function(e){console.log(e);a.dish=e[0]})}]);app.controller("orderCtrl",["$scope","$http","$stateParams","$httpParamSerializerJQLike",function(a,d,b,c){console.log(b.id);a.orderInfo={did:b.id,user_name:"",sex:1,addr:"",phone:""};a.submitOrder=function(){var e=c(a.orderInfo);console.log(e);d.get("data/order_add.php?"+e).success(function(f){if(f.length>0){if(f[0].msg=="succ"){a.result="下单成功，订单编号为"+f[0].oid;sessionStorage.setItem("phone",a.orderInfo.phone)}else{a.result="下单失败"}}})}}]);app.controller("myOrderCtrl",["$scope","$http",function(b,c){var a=sessionStorage.getItem("phone");console.log(a);c.get("data/order_getbyphone.php?phone="+a).success(function(d){console.log(d);b.orderList=d})}]);